webpackJsonp([5],{303:function(t,e,a){t.exports=a(304)},304:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}var i=a(49),s=n(i),o=a(55);n(o);!function(t){function e(e,a,n,i,s){return this.key=a,this.elem=e,this.callback=n,this.withForm=i,this.container=s,this.interval=null,this.draftId=null,this.component=null,this.$component=t(),this.componentName="",this.uid=null,t(this.elem).attr("name")&&""!=t(this.elem).attr("name")?(this.init(),this.bindEvents(),this.load({key:a},function(t){}),this):void console.error("Must set 'name' attribute ")}e.prototype={init:function(){this.uid=this._getUid(),this.appendComponent()},_getUid:function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},bindEvents:function(){var e=this;console.log(e),t(this.elem).on("input.draft",function(){e.saveEventHandler()}),e.$component.on("click",".draft_title",function(a){a.preventDefault();var n=t(this),i=n.data("type"),s=t(this).data("item");switch(e.onApply(s),i){case"modal":e.$component.xeModal("hide");break;case"collapse":e.$component.collapse("hide").find(".panel-body").empty()}}),e.$component.on("click",".xe-draftBtnCloseModal",function(){e.$component.xeModal("hide")}),e.$component.on("click",".btn_draft_delete",function(){var a=t(this),n=a.data("id");e.reqDelete(n,function(){a.closest("li").remove()})})},toggle:function(){var e=this;switch(this.componentName){case"modal":e.$component.hasClass("in")?e.$component.xeModal("hide"):e.load({key:e.key},function(t){var a='<div class="draft_save_list">';a+="<ul>",t.forEach(function(t,e){a+="<li>",a+="<a href='#' class='draft_title' data-item='"+JSON.stringify(t)+'\' data-type="modal">'+t.val+"</a>",a+='<div class="draft_info">',1==t.is_auto?a+='<span class="draft_state">'+XE.Lang.trans("xe::autoSave")+"</span>":a+='<span class="draft_state v2">'+XE.Lang.trans("xe::draftSave")+"</span>",a+='<span class="draft_date">'+t.created_at.substr(0,16).replace(/-/g," ")+"</span>",a+='<a href="#" class="btn_draft_delete" data-id="'+t.id+'"><i class="xi-close"></i></a>',a+="</div>",a+="</li>"}),a+="</ul>",a+="</div>",e.$component.find(".xe-modal-body").html(a),e.$component.xeModal("show")});break;case"collapse":e.$component.hasClass("in")?e.$component.collapse("hide"):e.load({key:e.key},function(a){var n='<div class="draft_save_list">';n+="<ul>",a.forEach(function(e,a){n+="<li>",n+="<a href='#' class='draft_title' data-item='"+JSON.stringify(e)+'\' data-type="collapse">'+t(t.parseHTML(e.val)).text()+"</a>",n+='<div class="draft_info">',1==e.is_auto?n+='<span class="draft_state">'+XE.Lang.trans("xe::autoSave")+"</span>":n+='<span class="draft_state v2">'+XE.Lang.trans("xe::draftSave")+"</span>",n+='<span class="draft_date">'+e.created_at.substr(0,16).replace(/-/g," ")+"</span>",n+='<a href="#" class="btn_draft_delete" data-id="'+e.id+'"><i class="xi-close"></i></a>',n+="</div>",n+="</li>"}),n+="</ul>",n+="</div>",e.$component.find(".panel-body").html(n),e.$component.collapse("show")})}},getModalTemplate:function(){return['<div class="xe-modal fade" id="xe-draftModal">','<div class="xe-modal-dialog">','<div class="xe-modal-content">','<div class="xe-modal-header">','<button type="button" class="btn-close xe-draftBtnClose" data-dismiss="xe-modal" aria-label="Close"><i class="xi-close"></i></button>','<strong class="xe-modal-title"></strong>',"</div>",'<div class="xe-modal-body"></div>','<div class="xe-modal-footer">','<button type="button" class="xe-btn xe-btn-default" data-dismiss="xe-modal">Close</button>',"</div>","</div>","</div>","</div>"].join("\n")},getCollapseTemplate:function(){return['<div class="panel panel-default">','<div class="panel-body"></div>',"</div>"].join("\n")},appendComponent:function(){var e=this,a=function(a){e.setId(a.id);var i=a.etc;i[t(e.elem).attr("name")]=a.val,n.init(t(e.elem).closest("form")[0],i),e.callback(i)},i=function(t){e.reqDelete(t.id)},s=t("<div>");this.key;if(t(this.container).length<1)t(this.elem).closest("form").after(s.html(this.getModalTemplate())),this.componentName="modal",this.$component=t("#xe-draftModal");else{this.componentName="collapse",this.$component=t(this.container);var o=this._collapseClass();this.$component.addClass([o,"collapse","in"].join(" ")).html(s.html(e.getCollapseTemplate()))}},onApply:function(e){var a=this;this.setId(e.id);var i=e.etc;i[t(a.elem).attr("name")]=e.val,n.init(t(a.elem).closest("form")[0],i),this.callback(i)},_collapseClass:function(){return"__xe_draft_collapse_"+this.uid},saveEventHandler:function(){var t=this;this.intervalClear(),this.interval=setTimeout(function(){t.setAuto(),t.intervalClear()},3e3)},intervalClear:function(){this.interval&&clearTimeout(this.interval)},draftSet:function(){""!=t.trim(t(this.elem).val())&&(null==this.draftId?this.reqPost():this.reqPut())},reqPost:function(){t.ajax({url:xeBaseURL+"/draft/store",type:"post",dataType:"json",data:this.getReqSerialize()+"&key="+this.key,success:function(t){null===t.draftId?this.unsetId():this.setId(t.draftId)}.bind(this)})},reqPut:function(){t.ajax({url:xeBaseURL+"/draft/update/"+this.draftId,type:"post",dataType:"json",data:this.getReqSerialize(),success:function(e){var a=this;null===e.draftId&&(this.$component.find("li > a").each(function(){var e=t(this),n=e.data("item");if(n.id===a.draftId){var i=t(a.elem).val();return n.val=i,n.etc.content=i,void e.data("item",n).text(t(t.parseHTML(i)).text())}}),this.unsetId())}.bind(this)})},setAuto:function(){t.ajax({url:xeBaseURL+"/draft/setAuto",type:"post",data:this.getReqSerialize()+"&key="+this.key})},deleteAuto:function(){t.ajax({url:xeBaseURL+"/draft/destroyAuto",type:"post",data:"key="+this.key})},load:function(e,a){t.ajax({url:xeBaseURL+"/draft",type:"get",dataType:"json",data:e,success:function(t){a&&a(t)}})},getItems:function(){return this.state.items.map(function(t,e){return s.default.createElement(a.Item,{key:t.id,data:t,onApply:this.onApply,onRemove:this.onRemove})}.bind(this))},getReqSerialize:function(){return(!0===this.withForm?t(this.elem).closest("form").serialize():[t(this.elem).attr("name"),t(this.elem).val()].join("="))+"&rep="+t(this.elem).attr("name")},reqDelete:function(e,a){(e=e||this.draftId)&&(e==this.draftId&&(this.draftId=null),t.ajax({url:xeBaseURL+"/draft/destroy/"+e,type:"post",dataType:"json",success:function(){a&&a()}}))},setId:function(t){this.draftId=t},unsetId:function(){this.draftId=null}};var a={mixin:{getInitialState:function(){return{loaded:!1,items:[]}},onRemove:function(t){this.props.onRemove(t)},load:function(){this.setState({loaded:!1}),t.ajax({url:xeBaseURL+"/draft",type:"get",dataType:"json",data:{key:this.props.keyVal},success:function(t){this.setState({loaded:!0,items:t})}.bind(this)})},getItems:function(){return this.state.items.map(function(t,e){return s.default.createElement(a.Item,{key:t.id,data:t,onApply:this.onApply,onRemove:this.onRemove})}.bind(this))}}},n={init:function(t,e){for(var a in e){var n=a;e[a]instanceof Array?(n+="[]",this.multiple(t[n],e[a])):this.single(t[n],e[a])}},multiple:function(e,a){t(e).is(":checkbox")?t.each(a,function(t,a){this.toCheckbox(e,a)}.bind(this)):t.each(a,function(a,n){this.toInput(t(e).eq(a)[0],n)}.bind(this))},single:function(e,a){t(e).is(":checkbox")?this.toCheckbox(e,a):t(e).is(":radio")?this.toRadio(e,a):t(e).is("select")?this.toSelect(e,a):this.toInput(e,a)},toCheckbox:function(e,a){t(e).each(function(){if(t(this).attr("value")==a)return t(this).prop("checked",!0),!1})},toRadio:function(e,a){t(e).each(function(){if(t(this).attr("value")==a)return t(this).prop("checked",!0),!1})},toSelect:function(e,a){t(e).children().each(function(){if(t(this).attr("value")==a)return t(this).prop("selected",!0),!1})},toInput:function(e,a){t(e).is("input[type=hidden]")||t(e).val(a)}};t.fn.draft=function(a){var n={container:null,withForm:!1,callback:null};if(a=t.extend({},n,a),!a.key||!a.btnLoad||!a.btnSave)return console.error("must need key, btnLoad and btnSave"),!1;var i=new e(this,a.key,a.callback,a.withForm,a.container);return t(a.btnLoad).unbind("click.draft").bind("click.draft",function(t){t.preventDefault(),i.toggle()}),t(a.btnSave).unbind("click.draft").bind("click.draft",function(t){t.preventDefault(),i.draftSet()}),i},t(document).on("click",".xe-draftBtnCloseModal",function(){t("#xe-draftModal").modal("hide")})}(jQuery)}},[303]);