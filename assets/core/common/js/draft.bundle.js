!function(t){function e(a){if(n[a])return n[a].exports;var i=n[a]={i:a,l:!1,exports:{}};return t[a].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,a){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:a})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=170)}({170:function(t,e,n){n(171),t.exports=n(172)},171:function(t,e,n){"use strict";var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};+function(t){var e=function e(n,a){this.$element=t(n),this.options=t.extend({},e.DEFAULTS,a),this.transitioning=null,this.options.parent&&(this.$parent=t(this.options.parent)),this.options.toggle&&this.toggle()};e.DEFAULTS={toggle:!0},e.prototype.dimension=function(){return this.$element.hasClass("width")?"width":"height"},e.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var e=t.Event("show.bs.collapse");if(this.$element.trigger(e),!e.isDefaultPrevented()){var n=this.$parent&&this.$parent.find("> .panel > .in");if(n&&n.length){var a=n.data("bs.collapse");if(a&&a.transitioning)return;n.collapse("hide"),a||n.data("bs.collapse",null)}var i=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[i](0),this.transitioning=1;var s=function(){this.$element.removeClass("collapsing").addClass("in")[i]("auto"),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!t.support.transition)return s.call(this);var o=t.camelCase(["scroll",i].join("-"));this.$element.one(t.support.transition.end,t.proxy(s,this)).emulateTransitionEnd(350)[i](this.$element[0][o])}}},e.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var e=t.Event("hide.bs.collapse");if(this.$element.trigger(e),!e.isDefaultPrevented()){var n=this.dimension();this.$element[n](this.$element[n]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse").removeClass("in"),this.transitioning=1;var a=function(){this.transitioning=0,this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")};if(!t.support.transition)return a.call(this);this.$element[n](0).one(t.support.transition.end,t.proxy(a,this)).emulateTransitionEnd(350)}}},e.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var n=t.fn.collapse;t.fn.collapse=function(n){return this.each(function(){var i=t(this),s=i.data("bs.collapse"),o=t.extend({},e.DEFAULTS,i.data(),"object"==(void 0===n?"undefined":a(n))&&n);s||i.data("bs.collapse",s=new e(this,o)),"string"==typeof n&&s[n]()})},t.fn.collapse.Constructor=e,t.fn.collapse.noConflict=function(){return t.fn.collapse=n,this},t(document).on("click.bs.collapse.data-api","[data-toggle=collapse]",function(e){var n,a=t(this),i=a.attr("data-target")||e.preventDefault()||(n=a.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,""),s=t(i),o=s.data("bs.collapse"),l=o?"toggle":a.data(),r=a.attr("data-parent"),c=r&&t(r);o&&o.transitioning||(c&&c.find('[data-toggle=collapse][data-parent="'+r+'"]').not(a).addClass("collapsed"),a[s.hasClass("in")?"addClass":"removeClass"]("collapsed")),s.collapse(l)})}(window.jQuery)},172:function(t,e,n){"use strict";!function(t){function e(e,n,a,i,s,o){var l=this;return this.key=n,this.elem=e,this.callback=a,this.withForm=i,this.container=s,this.apiUrl=o,this.interval=null,this.draftId=null,this.component=null,this.$component=t(),this.componentName="",this.uid=null,t(this.elem).attr("name")&&""!=t(this.elem).attr("name")?(this.init(),this.bindEvents(),this.load({key:n},function(e){e.forEach(function(e,n){if(1===e.is_auto)return t(l.elem).val(e.val),void l.callback(e)})}),this):void console.error("Must set 'name' attribute ")}e.prototype={init:function(){this.uid=this._getUid(),this.appendComponent()},_getUid:function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},bindEvents:function(){var e=this;t(this.elem).on("input.draft",function(){e.saveEventHandler()}),e.$component.on("click",".draft_title",function(n){n.preventDefault();var a=t(this),i=a.data("type"),s=t(this).data("item");switch(e.onApply(s),i){case"modal":e.$component.xeModal("hide");break;case"collapse":e.$component.collapse("hide").find(".panel-body").empty()}}),e.$component.on("click",".xe-draftBtnCloseModal",function(){e.$component.xeModal("hide")}),e.$component.on("click",".btn_draft_delete",function(n){n.preventDefault();var a=t(this),i=a.data("id");e.reqDelete(i,function(){a.closest("li").remove()})}),t(e.elem).closest("form").on("submit",function(t){e.deleteAuto(e.autoDraftId)})},toggle:function(e){var n=this;switch(this.componentName){case"modal":!e&&n.$component.hasClass("in")?n.$component.xeModal("hide"):n.load({key:n.key},function(t){var e='<div class="draft_save_list">';e+="<ul>",t.forEach(function(t,n){e+="<li>",e+="<a href='#' class='draft_title' data-item='"+JSON.stringify(t)+'\' data-type="modal">'+t.val+"</a>",e+='<div class="draft_info">',1==t.is_auto?e+='<span class="draft_state">'+XE.Lang.trans("xe::autoSave")+"</span>":e+='<span class="draft_state v2">'+XE.Lang.trans("xe::draftSave")+"</span>",e+='<span class="draft_date">'+t.created_at.substr(0,16).replace(/-/g," ")+"</span>",e+='<a href="#" class="btn_draft_delete" data-id="'+t.id+'"><i class="xi-close"></i></a>',e+="</div>",e+="</li>"}),e+="</ul>",e+="</div>",n.$component.find(".xe-modal-body").html(e),n.$component.xeModal("show")});break;case"collapse":!e&&n.$component.hasClass("in")?n.$component.collapse("hide"):n.load({key:n.key},function(e){var a='<div class="draft_save_list">';a+="<ul>",e.forEach(function(e,n){a+="<li>",a+="<a href='#' class='draft_title' data-item='"+JSON.stringify(e)+'\' data-type="collapse">'+t(t.parseHTML(e.val)).text()+"</a>",a+='<div class="draft_info">',1==e.is_auto?a+='<span class="draft_state">'+XE.Lang.trans("xe::autoSave")+"</span>":a+='<span class="draft_state v2">'+XE.Lang.trans("xe::draftSave")+"</span>",a+='<span class="draft_date">'+e.created_at.substr(0,16).replace(/-/g," ")+"</span>",a+='<a href="#" class="btn_draft_delete" data-id="'+e.id+'"><i class="xi-close"></i></a>',a+="</div>",a+="</li>"}),a+="</ul>",a+="</div>",n.$component.find(".panel-body").html(a),n.$component.collapse("show")})}},getModalTemplate:function(){return['<div class="xe-modal fade" id="xe-draftModal">','<div class="xe-modal-dialog">','<div class="xe-modal-content">','<div class="xe-modal-header">','<button type="button" class="btn-close xe-draftBtnClose" data-dismiss="xe-modal" aria-label="Close"><i class="xi-close"></i></button>','<strong class="xe-modal-title"></strong>',"</div>",'<div class="xe-modal-body"></div>','<div class="xe-modal-footer">','<button type="button" class="xe-btn xe-btn-default" data-dismiss="xe-modal">Close</button>',"</div>","</div>","</div>","</div>"].join("\n")},getCollapseTemplate:function(){return['<div class="panel panel-default">','<div class="panel-body"></div>',"</div>"].join("\n")},appendComponent:function(){var e=this,n=t("<div>");if(t(this.container).length<1)t(this.elem).closest("form").after(n.html(this.getModalTemplate())),this.componentName="modal",this.$component=t("#xe-draftModal");else{this.componentName="collapse",this.$component=t(this.container);var a=this._collapseClass();this.$component.addClass([a,"collapse"].join(" ")).html(n.html(e.getCollapseTemplate()))}},onApply:function(e){var a=this;this.setId(e.id);var i=e.etc;i[t(a.elem).attr("name")]=e.val,n.init(t(a.elem).closest("form")[0],i),this.callback(i)},_collapseClass:function(){return"__xe_draft_collapse_"+this.uid},saveEventHandler:function(){var t=this;this.intervalClear(),this.interval=setTimeout(function(){t.setAuto(),t.intervalClear()},3e3)},intervalClear:function(){this.interval&&clearTimeout(this.interval)},draftSet:function(){""!=t.trim(t(this.elem).val())&&(null==this.draftId?this.reqPost():this.reqPut())},reqPost:function(){t.ajax({url:this.apiUrl.draft.add,type:"post",dataType:"json",data:this.getReqSerialize()+"&key="+this.key,success:function(t){null===t.draftId?this.unsetId():this.setId(t.draftId)}.bind(this)})},reqPut:function(){t.ajax({url:this.apiUrl.draft.update+"/"+this.draftId,type:"post",dataType:"json",data:this.getReqSerialize(),success:function(e){var n=this;null===e.draftId&&(this.$component.find("li > a").each(function(){var e=t(this),a=e.data("item");if(a.id===n.draftId){var i=t(n.elem).val();return a.val=i,a.etc.content=i,void e.data("item",a).text(t(t.parseHTML(i)).text())}}),this.unsetId())}.bind(this)})},setAuto:function(){t.ajax({url:this.apiUrl.auto.set,type:"post",data:this.getReqSerialize()+"&key="+this.key})},deleteAuto:function(e){var e=e||this.key;e&&t.ajax({url:this.apiUrl.auto.unset,type:"post",data:"key="+e})},load:function(e,n){var a=this;t.ajax({url:a.apiUrl.draft.list,type:"get",dataType:"json",data:e,success:function(t){t.forEach(function(t,e){if(1===t.is_auto)return void(a.autoDraftId=t.id)}),n&&n(t)}})},getReqSerialize:function(){return(!0===this.withForm?t(this.elem).closest("form").serialize():[t(this.elem).attr("name"),t(this.elem).val()].join("="))+"&rep="+t(this.elem).attr("name")},reqDelete:function(e,n){var a=this;(e=e||this.draftId)&&(e==this.draftId&&(this.draftId=null),t.ajax({url:a.apiUrl.draft.delete+"/"+e,type:"post",dataType:"json",success:function(){n&&n()}}))},setId:function(t){this.draftId=t},unsetId:function(){this.draftId=null}};var n={init:function(t,e){for(var n in e){var a=n;e[n]instanceof Array?(a+="[]",this.multiple(t[a],e[n])):this.single(t[a],e[n])}},multiple:function(e,n){t(e).is(":checkbox")?t.each(n,function(t,n){this.toCheckbox(e,n)}.bind(this)):t.each(n,function(n,a){this.toInput(t(e).eq(n)[0],a)}.bind(this))},single:function(e,n){t(e).is(":checkbox")?this.toCheckbox(e,n):t(e).is(":radio")?this.toRadio(e,n):t(e).is("select")?this.toSelect(e,n):this.toInput(e,n)},toCheckbox:function(e,n){t(e).each(function(){if(t(this).attr("value")==n)return t(this).prop("checked",!0),!1})},toRadio:function(e,n){t(e).each(function(){if(t(this).attr("value")==n)return t(this).prop("checked",!0),!1})},toSelect:function(e,n){t(e).children().each(function(){if(t(this).attr("value")==n)return t(this).prop("selected",!0),!1})},toInput:function(e,n){t(e).is("input[type=hidden]")||t(e).val(n)}};t.fn.draft=function(n){var a={container:null,withForm:!1,callback:null};if(n=t.extend({},a,n),!n.key||!n.btnLoad||!n.btnSave)return console.error("must need key, btnLoad and btnSave"),!1;var i=new e(this,n.key,n.callback,n.withForm,n.container,n.apiUrl);return t(n.btnLoad).unbind("click.draft").bind("click.draft",function(t){t.preventDefault(),i.toggle(!0)}),t(n.btnSave).unbind("click.draft").bind("click.draft",function(t){t.preventDefault(),i.draftSet()}),i}}(jQuery)}});