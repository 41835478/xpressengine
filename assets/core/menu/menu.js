System.amdDefine("MenuEntity",["vendor:/react"],function(e){"use strict";var t=e.createClass({displayName:"MenuEntity",propTypes:{index:e.PropTypes.object,onCollapse:e.PropTypes.func,getBaseUrl:e.PropTypes.func},handleCollapse:function(e){e.stopPropagation();var t=this.props.index.id;this.props.onCollapse&&this.props.onCollapse(t)},render:function(){var t=this.props.index,n=t.node,s=this.props.getBaseUrl()+"/menus/"+n.id,r=this.props.getBaseUrl()+"/menus/"+n.id+"/types",i={addItem:XE.Lang.trans("xe::addItem")},a="xe_tree_node_"+n.id;return e.createElement("div",{className:"panel-heading",id:a},e.createElement("div",{className:"pull-left"},e.createElement("a",{href:s},e.createElement("h3",null,e.createElement("i",{className:"xi-folder"}),n.title))),e.createElement("div",{className:"pull-right"},e.createElement("a",{href:r,className:"btn btn-primary"},e.createElement("i",{className:"xi-plus"}),e.createElement("span",null,i.addItem))))}});return t}),System.amdDefine("MenuItem",["vendor:/react","vendor:/react-dom"],function(e,t){"use strict";var n=e.createClass({displayName:"MenuItem",propTypes:{index:e.PropTypes.object,home:e.PropTypes.string,getBaseUrl:e.PropTypes.func,clickHome:e.PropTypes.func,mouseDown:e.PropTypes.func,getSelectedNode:e.PropTypes.func,setSelectedNode:e.PropTypes.func},onClickLink:function(e){"xpressengine@directLink"!==e.type?location.href="/"+e.url:location.href=e.url},componentDidUpdate:function(){var e=this.props.getSearchedNode(),t=this.props.index.node;e===t&&($("html, body").animate({scrollTop:$("#xe_tree_node_"+t.id).offset().top-20},500),this.props.setSearchedNode(null))},onClickHome:function(e){this.props.clickHome(e)},handleMouseDown:function(e){var n=this.props.index.id,s=t.findDOMNode(this.refs.inner);this.props.mouseDown(n,s,e)},onClickSetNode:function(e){var t=this.props.getSelectedNode();t===e?this.props.setSelectedNode(null):this.props.setSelectedNode(e)},render:function(){var t=this.props.index.node,n=t.title||"",s=t.type,r="",i={title:XE.Lang.trans(n),setHome:XE.Lang.trans("xe::setHome"),goLink:XE.Lang.trans("xe::goLink")};r="xpressengine@directLink"!==t.type?t.id==this.props.home?"/":"/"+t.url:t.url;var a,o=this.props.getBaseUrl()+"/menus/"+t.menuId+"/items/"+t.id;a=t.id==this.props.home?e.createElement("button",{type:"button",className:"btn-link hidden-xs home-on"},e.createElement("i",{className:"xi-home"})):1===t.activated?e.createElement("button",{type:"button",className:"btn btn-link hidden-xs",onClick:this.onClickHome.bind(null,t)},e.createElement("i",{className:"xi-home"})):null;var d,l=this.props.getSelectedNode();l==t&&(d=e.createElement("div",{className:"visible-xs more-area",style:{display:"block"}},e.createElement("button",{className:"btn",type:"button",onClick:this.onClickHome.bind(null,t)},i.setHome),e.createElement("a",{href:r,className:"btn"},i.goLink)));var c="xe_tree_node_"+t.id;return e.createElement("div",{className:"item-content",ref:"inner",id:c},e.createElement("button",{className:"btn handler",onMouseDown:this.handleMouseDown},e.createElement("i",{className:"xi-bullet-point"})),e.createElement("div",{className:"item-info"},e.createElement("i",{className:"xi-paper"}),e.createElement("dl",null,e.createElement("dt",{className:"sr-only"},i.title),e.createElement("dd",{className:"ellipsis"},e.createElement("a",{href:o},i.title)),e.createElement("dt",{className:"sr-only"},r),e.createElement("dd",{className:"text-blue ellipsis"},e.createElement("a",{href:r},r),e.createElement("em",null,"[",s,"]")))),e.createElement("div",{className:"btn-group pull-right"},e.createElement("button",{type:"button",className:"btn-more visible-xs",onClick:this.onClickSetNode.bind(null,t)},e.createElement("i",{className:"xi-ellipsis-v"})),a),d)}});return n}),System.amdDefine("TreeNode",["vendor:/react","MenuEntity","MenuItem"],function(e,t,n){"use strict";var s=e.createClass({displayName:"TreeNode",propTypes:{index:e.PropTypes.object,tree:e.PropTypes.object,home:e.PropTypes.string,dragging:e.PropTypes.string,onDragStart:e.PropTypes.func,onCollapse:e.PropTypes.func,getBaseUrl:e.PropTypes.func,clickHome:e.PropTypes.func,getSelectedNode:e.PropTypes.func,setSelectedNode:e.PropTypes.func,getSearchedNode:e.PropTypes.func,setSearchedNode:e.PropTypes.func},renderChildren:function(){var t=this.props,n=t.index,r=t.tree,i=t.dragging,a=t.home,o=t.getBaseUrl,d=t.onDragStart,l=t.isDragging,c=n.id===i||this.props.isPlaceHolder;if(n.children&&n.children.length){var p={},u=n.children;if(n.collapsed){var h=t.getSearchedNode();null===h||n.id!=h.menuId?p.display="none":n.collapsed=!n.collapsed}var m=u.map(function(n){var p=r.getIndex(n);return e.createElement(s,{tree:r,index:p,key:p.id,dragging:i,home:a,onDragStart:d,isDragging:l,isPlaceHolder:c,clickHome:t.clickHome,getSelectedNode:t.getSelectedNode,setSelectedNode:t.setSelectedNode,getSearchedNode:t.getSearchedNode,setSearchedNode:t.setSearchedNode,getBaseUrl:o})});return e.createElement("div",{className:cx({"item-container":!0,move:l}),style:p},m)}return null},render:function(){var s=this.props,r=s.index,i=s.home,a=r.node,o=this.isPlaceHolder(s);return this.isMenuEntity(a)?e.createElement("div",{className:"menu-type"},e.createElement(t,{index:r,getBaseUrl:s.getBaseUrl,onCollapse:s.onCollapse}),this.renderChildren()):e.createElement("div",{className:cx({node:!0,item:!0,copy:o,off:1!==a.activated})},e.createElement(n,{index:r,home:i,getBaseUrl:s.getBaseUrl,clickHome:s.clickHome,mouseDown:this.handleMouseDown,getSelectedNode:s.getSelectedNode,setSelectedNode:s.setSelectedNode,getSearchedNode:s.getSearchedNode,setSearchedNode:s.setSearchedNode}),this.renderChildren())},handleMouseDown:function(e,t,n){this.props.onDragStart&&this.props.onDragStart(e,t,n)},isMenuEntity:function(e){return e.entity&&"menu"==e.entity},isPlaceHolder:function(e){var t=e.index,n=e.dragging;return t.id===n||e.isPlaceHolder}});return s}),System.amdDefine("MenuSearchBar",["vendor:/react","vendor:/react-dom","MenuSearchSuggestion"],function(e,t,n){"use strict";var s=e.createClass({displayName:"MenuSearchBar",propTypes:{tree:e.PropTypes.object,placeholder:e.PropTypes.string,handleSearch:e.PropTypes.func,menuRoutes:e.PropTypes.object},getDefaultProps:function(){return{placeholder:"Search...",tree:new Tree({})}},componentDidMount:function(){},getInitialState:function(){return{query:"",suggestions:[],selectedIndex:-1,selectionMode:!1,searchingCnt:0}},handleChange:function(e){var t=e.target.value.trim();this.setState({query:t}),this.searchMenu(t),0==t.length&&this.setState({suggestions:[],searchingCnt:0})},searchMenu:function(e){var t,n=this,s=this.state.searchingCnt+1,r=this.props.tree;this.setState({searchingCnt:s}),t=_.filter(r.indexes,function(t){if(0==t.id)return!1;var s=t.node.title;return n.isMenuEntity(t.node)||(s=XE.Lang.trans(t.node.title)),!(!s||-1===s.indexOf(e))}),s=this.state.searchingCnt,s-=1,n.setState({suggestions:t,searchingCnt:s})},isMenuEntity:function(e){return e.entity&&"menu"==e.entity},resetSearch:function(){var e=t.findDOMNode(this.refs.input);this.setState({query:"",selectedIndex:-1,selectionMode:!1,suggestions:[]}),e.value="",e.focus()},handleKeyDown:function(e){var t=this.state,n=t.query,s=t.selectedIndex,r=t.suggestions;e.keyCode===Keys.ESCAPE&&(e.preventDefault(),this.resetSearch()),e.keyCode!==Keys.ENTER&&e.keyCode!==Keys.TAB||""==n||(e.preventDefault(),this.state.selectionMode&&this.selection(this.state.suggestions[this.state.selectedIndex])),e.keyCode===Keys.UP_ARROW&&(e.preventDefault(),0>=s?this.setState({selectedIndex:this.state.suggestions.length-1,selectionMode:!0}):this.setState({selectedIndex:s-1,selectionMode:!0})),e.keyCode===Keys.DOWN_ARROW&&(e.preventDefault(),this.setState({selectedIndex:(this.state.selectedIndex+1)%r.length,selectionMode:!0}))},selection:function(e){var n=t.findDOMNode(this.refs.input);this.props.handleSearch(e.node),this.setState({query:"",selectionMode:!1,selectedIndex:-1}),n.value="",n.focus()},handleSuggestionClick:function(e,t){t.preventDefault(),this.selection(this.state.suggestions[e])},handleSuggestionHover:function(e,t){this.setState({selectedIndex:e,selectionMode:!0})},render:function(){var t=this.state.query.trim(),s=this.state.selectedIndex,r=this.state.suggestions,i=this.props.placeholder,a={addMenu:XE.Lang.trans("xe::addMenu")};return e.createElement("div",{className:"panel-heading"},e.createElement("div",{className:"pull-left"},e.createElement("div",{className:cx({"input-group":!0,"search-group":!0,open:t.length>0})},e.createElement("input",{type:"text",className:"form-control","aria-label":"Text input with dropdown button",placeholder:i,ref:"input",onChange:this.handleChange,onKeyDown:this.handleKeyDown}),e.createElement("button",{className:"btn-link",onClick:this.resetSearch},e.createElement("i",{className:"xi-magnifier"}),e.createElement("span",{className:"sr-only"},"검색")),e.createElement(n,{query:t,suggestions:r,selectedIndex:s,handleClick:this.handleSuggestionClick,handleHover:this.handleSuggestionHover}))),e.createElement("div",{className:"pull-right"},e.createElement("a",{href:this.props.menuRoutes.createMenu,className:"btn btn-primary pull-right"},e.createElement("i",{className:"xi-plus"})," ",a.addMenu)))}});return s}),System.amdDefine("UITree",["vendor:/react","TreeNode"],function(e,t){var n=e.createClass({displayName:"UITree",propTypes:{tree:e.PropTypes.object,home:e.PropTypes.string,paddingLeft:e.PropTypes.number,getBaseUrl:e.PropTypes.func,clickHome:e.PropTypes.func,getSelectedNode:e.PropTypes.func,setSelectedNode:e.PropTypes.func,getSearchedNode:e.PropTypes.func,setSearchedNode:e.PropTypes.func,moveNode:e.PropTypes.func},getDefaultProps:function(){return{paddingLeft:48}},getInitialState:function(){return this.init(this.props)},componentWillReceiveProps:function(e){this._update?this._update=!1:this.setState(this.init(e))},init:function(e){var t=e.tree;return t.updateNodesPosition(),{tempTree:null,tree:t,dragging:{id:null,x:null,y:null,w:null,h:null,originalParent:null,targetParent:null}}},getDraggingDom:function(){var n=this.state.tree,s=this.state.dragging,r=this.props.home;if(s&&s.id){var i=n.getIndex(s.id),a={top:s.y,left:s.x,width:s.w};return e.createElement("div",{className:"m-draggable move",style:a},e.createElement(t,{getBaseUrl:this.props.getBaseUrl,clickHome:this.props.clickHome,getSelectedNode:this.props.getSelectedNode,setSelectedNode:this.props.setSelectedNode,getSearchedNode:this.props.getSearchedNode,setSearchedNode:this.props.setSearchedNode,tree:n,home:r,index:i,key:s.id,isDragging:!0}))}return null},render:function(){var n=this.state.tree,s=this.state.dragging,r=this.getDraggingDom(),i=this,a=this.props.home,o=n.getIndex(0),d=o.children.map(function(r){return e.createElement(t,{tree:n,home:a,index:n.getIndex(r),getBaseUrl:i.props.getBaseUrl,clickHome:i.props.clickHome,getSelectedNode:i.props.getSelectedNode,setSelectedNode:i.props.setSelectedNode,getSearchedNode:i.props.getSearchedNode,setSearchedNode:i.props.setSearchedNode,key:r,onDragStart:i.dragStart,onCollapse:i.toggleCollapse,dragging:s&&s.id,isDragging:!1})});return e.createElement("div",{className:"menu-content",id:"uitree"},r,d)},dragStart:function(e,t,n){var s=this.state.tree,r=s.get(e);r.entity&&"menu"==r.entity||(this.setState({tempTree:new Tree(s.obj)}),this.dragging={id:e,w:t.offsetWidth,h:t.offsetHeight,x:t.offsetLeft,y:t.offsetTop,originalParent:s.get(e).parentId,targetParent:s.get(e).parentId,originalOrdering:s.get(e).ordering,lastOrdering:s.get(e).ordering},this._startX=t.offsetLeft,this._startY=t.offsetTop,this._offsetX=n.clientX,this._offsetY=n.clientY,this._start=!0,document.body.addEventListener("keydown",this.dragStop),document.body.addEventListener("mousemove",this.drag),document.body.addEventListener("mouseup",this.dragEnd))},drag:function(e){this._start&&(this.setState({dragging:this.dragging}),this._start=!1);var t=this.state.tree,n=this.state.dragging,s=this.props.paddingLeft,r=null,i=t.getIndex(n.id),a=i.collapsed,o=this._startX,d=this._startY,l=this._offsetX,c=this._offsetY,p={x:o+e.clientX-l,y:d+e.clientY-c};n.x=p.x,n.y=p.y;var u=n.x-s/2-(i.left-3)*s,h=n.y-n.h/2-(i.top-2)*n.h;if(2==i.depth&&0>u&&(u=0),0>u?i.parent&&!i.next&&(r=t.move(i.id,i.parent,"after")):u>s&&i.prev&&!t.getIndex(i.prev).collapsed&&(r=t.move(i.id,i.prev,"append")),r&&(i=r,r.collapsed=a,n.id=r.id),0>h){var m=t.getNodeByTop(i.top-1);r=t.move(i.id,m.id,"before")}else if(h>n.h){var g;i.next?(g=t.getIndex(i.next),r=g.children&&g.children.length&&!g.collapsed?t.move(i.id,i.next,"prepend"):t.move(i.id,i.next,"after")):(g=t.getNodeByTop(i.top+i.height),g&&g.parent!==i.id&&(r=g.children&&g.children.length?t.move(i.id,g.id,"prepend"):t.move(i.id,g.id,"after")))}if(r){r.collapsed=a,n.id=r.id;var f=t.get(r.parent);n.targetParent=f.id,n.lastOrdering=r.ordering}this.setState({tree:t,dragging:n})},dragStop:function(e){var t={ENTER:13,TAB:9,BACKSPACE:8,UP_ARROW:38,DOWN_ARROW:40,ESCAPE:27};e.keyCode===t.ESCAPE&&e.preventDefault(),this.rollbackTree(),document.body.removeEventListener("mousemove",this.drag),document.body.removeEventListener("mouseup",this.dragEnd),document.body.removeEventListener("keydown",this.dragStop)},dragEnd:function(){this.setState({tempTree:null,dragging:{id:null,x:null,y:null,w:null,h:null,originalParent:null,targetParent:null}});var e=this.dragging;if(e.originalParent==e.targetParent){if(e.originalOrdering!=e.lastOrdering){var t=this.state.tree.get(e.id);"menu"!=t.entity&&this.props.moveNode({id:e.id,parent:e.targetParent,position:e.lastOrdering})}}else this.props.moveNode({id:e.id,parent:e.targetParent,position:e.lastOrdering});document.body.removeEventListener("mousemove",this.drag),document.body.removeEventListener("mouseup",this.dragEnd),document.body.removeEventListener("keydown",this.dragStop)},rollbackTree:function(){var e=this.state.tempTree;if(e){var t=this.props;t.tree=e,this.setState(this.init(t)),this.setState({tree:e,dragging:{id:null,x:null,y:null,w:null,h:null,originalParent:null,targetParent:null}})}},toggleCollapse:function(e){var t=this.state.tree,n=t.getIndex(e),s=t.get(e);n.collapsed=!n.collapsed,s.collapsed=!s.collapsed,t.updateNodesPosition(),this.setState({tree:t})}});return n}),System.amdDefine("MenuSearchSuggestion",["vendor:/react"],function(e){"use strict";var t=2,n=e.createClass({displayName:"MenuSearchSuggestion",propTypes:{query:e.PropTypes.string.isRequired,handleClick:e.PropTypes.func.isRequired,handleHover:e.PropTypes.func.isRequired,searchingCnt:e.PropTypes.number,suggestions:e.PropTypes.array,selectedIndex:e.PropTypes.number},markIt:function(e,t){var n=t.trim().replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&"),s=RegExp(n,"gi"),r=e.node.title;return this.isMenuEntity(e.node)||(r=XE.Lang.trans(e.node.title)),{__html:r.replace(s,"<em>$&</em>")}},isMenuEntity:function(e){return e.entity&&"menu"==e.entity},render:function(){var n=this.props,s=this.props.suggestions.map(function(t,s){return e.createElement("li",{key:s,onClick:n.handleClick.bind(null,s),onMouseOver:n.handleHover.bind(null,s),className:cx({on:s==n.selectedIndex})},e.createElement("a",{href:"#",dangerouslySetInnerHTML:this.markIt(t,n.query)}))}.bind(this));return s&&0===s.length||n.query.length<t?e.createElement("div",{className:"search-list"}):e.createElement("div",{className:"search-list"},e.createElement("ul",null,s))}});return n}),System.amdDefine("MenuTree",["vendor:/react","MenuSearchBar","UITree"],function(e,t,n){"use strict";var s=e.createClass({displayName:"MenuTree",getInitialState:function(){return{rawTree:this.props.menus,dataTree:new Tree({title:"root",items:this.props.menus}),selected:null,searched:null,home:this.props.home,menuRoutes:this.props.menuRoutes}},componentDidMount:function(){this.state.dataTree.movementFilter=this.movementFilter},getSearchedNode:function(){return this.state.searched},setSearchedNode:function(e){this.setState({searched:e})},getSelectedNode:function(){return this.state.selected},setSelectedNode:function(e){this.setState({selected:e})},movementFilter:function(e){var t=e.tree,n=t.get(e.toId),s=t.getIndex(e.toId),r=t.get(e.fromId);if(!this.isMenuEntity(r)){if(this.isMenuEntity(n)){if("after"==e.placement)return e.placement="prepend",e;if("before"==e.placement){if(s.prev&&null!=s.prev){var i=t.getIndex(s.prev);return e.toId=s.prev,i.collapsed||(e.placement="append"),e}return}return e}if("append"!=e.placement&&"prepend"!=e.placement||!(s.depth>MaxDepth))return e}},moveMenuItem:function(e){var t=this.props.baseUrl+"/moveItem";XE.ajax({url:t,context:$("#uitree"),type:"put",dataType:"json",data:{itemId:e.id,parent:e.parent,ordering:e.position},success:function(e){XE.toast("success","Item moved")}.bind(this)})},getBaseUrl:function(){return this.props.baseUrl},onClickHome:function(e){var t=this.props.baseUrl+"/setHome",n=this.state.home;this.setState({home:e.id}),XE.ajax({url:t,context:$("#uitree"),type:"put",dataType:"json",data:{itemId:e.id},success:function(t){XE.toast("success",e.title+" is home!")}.bind(this),error:function(e){XE.toast("error","home setting was failed!"),this.setState({home:n})}.bind(this)})},render:function(){return e.createElement("div",{className:"col-sm-12"},e.createElement("div",{className:"panel"},e.createElement(t,{tree:this.state.dataTree,handleSearch:this.setSearchedNode,menuRoutes:this.state.menuRoutes}),e.createElement("div",{className:"panel-body"},e.createElement(n,{paddingLeft:25,tree:this.state.dataTree,home:this.state.home,getBaseUrl:this.getBaseUrl,clickHome:this.onClickHome,getSearchedNode:this.getSearchedNode,setSearchedNode:this.setSearchedNode,getSelectedNode:this.getSelectedNode,setSelectedNode:this.setSelectedNode,moveNode:this.moveMenuItem}))))},isMenuEntity:function(e){return e.entity&&"menu"==e.entity}});return s});