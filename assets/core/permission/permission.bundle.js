webpackJsonp([5],{33:function(e,a,t){e.exports=t(34)},34:function(e,a,t){"use strict";function s(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,a){for(var t=0;t<a.length;t++){var s=a[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(a,t,s){return t&&e(a.prototype,t),s&&e(a,s),a}}(),n={ENTER:13,TAB:9,BACKSPACE:8,UP_ARROW:38,DOWN_ARROW:40,ESCAPE:27},r=function(){function e(a){var t=a.$wrapper,i=a.key,n=a.memberSearchUrl,r=a.groupSearchUrl,c=a.permission,l=a.type,p=a.vgroupAll;s(this,e),this.$wrapper=t,this.key=i,this.memberSearchUrl=n,this.groupSearchUrl=r,this.permission=c,this.type=l,this.vgroupAll=p,this.query="",this.suggestion=[],this.placeholder=XE.Lang.trans("xe::explainIncludeUserOrGroup"),this.selectedIndex="",this.includeSelectedIndex=-1,this.excludeSelectedIndex=-1,this.MIN_QUERY_LENGTH=2}return i(e,[{key:"bindEvents",value:function(){var e=this;this.$wrapper.on("change",".chkModeAble",function(a){$(a.target).is(":checked")?e.$wrapper.find("input:not(.chkModeAble)").prop("disabled",!0):e.$wrapper.find("input:not(.chkModeAble)").prop("disabled",!1)}),this.$wrapper.on("keydown",".inputMemberGroup",function(a){var t=a.target.value.trim(),s=$(this),i=a.keyCode,r=s.parent().find(".ReactTags__suggestions ul"),c=s.data("input");if(t.length>=e.MIN_QUERY_LENGTH){if(r.length>0){var l=parseInt(s.data("index"),10),p=0;switch(i){case n.UP_ARROW:p=0==l?r.find("li").length-1:l-1,s.data("index",p),r.find("li").eq(p).addClass("active").siblings().removeClass("active");break;case n.DOWN_ARROW:p=l==r.find("li").length-1?0:l+1,s.data("index",p),r.find("li").eq(p).addClass("active").siblings().removeClass("active");break;case n.ENTER:case n.TAB:if(a.preventDefault(),r.find("li.active").length>0){var o=r.find("li.active").data("tag"),d="",u="",g="";"member"==r.data("target")?"include"==c?(d=e.type+"User",u="user",g="@"):(d=e.type+"Except",u="except",g="@"):(d=e.type+"Group",u="group",g="%");var m=e.permission[u],v=!1;m.length>0?(m.forEach(function(e,a){e.id===o.id&&(v=!0)}),v||e.permission[u].push(o)):e.permission[u].push(o);var h=e.permission[u].map(function(e){return e.id});v||(r.closest(".ReactTags__tags").find("[name="+d+"]").val(h.join().trim()),r.closest(".ReactTags__tags").find("."+u+"Wrap").append('<span class="ReactTags__tag">'+(g+(o.display_name||o.name))+'<a class="ReactTags__remove btnRemoveTag" data-id="'+o.id+'">x</a></span>')),r.remove(),s.val("").data("index",-1).focus()}a.preventDefault();break;case n.ESCAPE:e[c+"SelectedIndex"]=0,r.parent().empty(),s.focus()}}}else if(n.BACKSPACE===i){var f=s.closest(".ReactTags__tags").find(".ReactTags__selected span");!t&&f.length>0&&e.removeTag(f.eq(f.length-1))}}),this.$wrapper.find(".ReactTags__suggestions").on("mouseenter","li",function(){var e=$(this);e.closest("ul");e.addClass("active").siblings().removeClass("active")}),this.$wrapper.find(".ReactTags__suggestions").on("click","li",function(){var a=$(this),t=a.data("tag"),s=a.closest("ul"),i=a.closest(".ReactTags__tagInput").find("input:text"),n=i.data("input"),r=(t.id,""),c="",l="";"member"==s.data("target")?"include"==n?(r=e.type+"User",c="user",l="@"):(r=e.type+"Except",c="except",l="@"):(r=e.type+"Group",c="group",l="%");var p=e.permission[c],o=!1;p.length>0?(p.forEach(function(e,a){e.id===t.id&&(o=!0)}),o||e.permission[c].push(t)):e.permission[c].push(t);var d=e.permission[c].map(function(e){return e.id});o||(s.closest(".ReactTags__tags").find("[name="+r+"]").val(d.join().trim()),s.closest(".ReactTags__tags").find("."+c+"Wrap").append('<span class="ReactTags__tag">'+(l+(t.display_name||t.name))+'<a class="ReactTags__remove btnRemoveTag" data-id="'+t.id+'">x</a></span>')),s.remove(),i.val("").data("index",-1).focus()}),this.$wrapper.on("keyup",".inputMemberGroup",function(a){var t=a.target.value.trim(),s=$(this),i=a.keyCode;if(t.length>=e.MIN_QUERY_LENGTH){if(-1==[n.ENTER,n.TAB,n.UP_ARROW,n.DOWN_ARROW,n.ESCAPE,37,39].indexOf(i)){var r="";r+="<ul>",r+='<li>Searching ... <span class="spinner" role="spinner"><span class="spinner-icon"></span></span></li>',r+="</ul>",s.parent().find(".ReactTags__suggestions").html(r);var c=t.substr(0,1);switch(c){case"@":t=t.substr(1,t.length),e.searchMember(s,t);break;case"%":t=t.substr(1,t.length),e.searchGroup(s,t)}}}else s.parent().find(".ReactTags__suggestions").empty()}),this.$wrapper.on("click",".btnRemoveTag",function(a){a.preventDefault(),e.removeTag($(this).closest("span"))})}},{key:"makeIt",value:function(e,a){var t=a.trim().replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&"),s=RegExp(t,"gi");return(e.display_name||e.name).replace(s,"<mark>$&</mark>")}},{key:"removeTag",value:function(e){var a=this,t=e.closest(".ReactTags__selected").data("ptype"),s=e.data("id"),i="";switch(t){case"user":i=a.type+"User";break;case"except":i=a.type+"Except";break;case"group":i=a.type+"Group"}a.permission[t].forEach(function(e,i){e.id!==s&&a.permission[t].splice(i,1)});var n=a.permission[t].map(function(e){return e.id});e.closest(".ReactTags__tags").find("[name="+i+"]").val(n.join().trim()),e.remove()}},{key:"searchMember",value:function(e,a){var t=this,s=t.memberSearchUrl;$.ajax({url:s+"/"+a,method:"get",dataType:"json",cache:!1,success:function(s){if(s.length>0){var i="";i+='<ul data-target="member">',s.forEach(function(e,s){i+='<li class="" data-tag=\''+JSON.stringify(e)+"'>",i+="<span>"+t.makeIt(e,a)+"</span>",i+="</li>"}),i+="</ul>",e.parent().find(".ReactTags__suggestions").html(i)}else e.parent().find(".ReactTags__suggestions").empty()},error:function(e,a,t){}})}},{key:"searchGroup",value:function(e,a){var t=this,s=t.groupSearchUrl;$.ajax({url:s+"/"+a,method:"get",dataType:"json",cache:!1,success:function(s){if(console.log(s),s.length>0){var i="";i+='<ul data-target="group">',s.forEach(function(e,s){i+="<li data-tag='"+JSON.stringify(e)+"'>",i+="<span>"+t.makeIt(e,a)+"</span>",i+="</li>"}),i+="</ul>",e.parent().find(".ReactTags__suggestions").html(i)}else e.parent().find(".ReactTags__suggestions").empty()},error:function(e,a,t){}})}},{key:"render",value:function(){var e=this,a=this.permission.mode,t=this.permission.rating,s=!1,i=[{value:"super",name:XE.Lang.trans("xe::memberRatingAdministrator")},{value:"manager",name:XE.Lang.trans("xe::memberRatingManager")},{value:"member",name:XE.Lang.trans("xe::member")},{value:"guest",name:XE.Lang.trans("xe::guest")}],n=!1;"manual"!==a&&"inherit"!==a||(s=!0,"manual"!==a&&(n=!0));var r=this.permission.group.map(function(e){return e.id}),c=this.permission.user.map(function(e){return e.id}),l=this.permission.except.map(function(e){return e.id}),p="";if(p+="<div>",s){var o="inherit"===a?'checked="checked"':"";p+='<div class="form-group">',p+='<div class="checkbox">',p+='<label><input type="checkbox" name="'+this.type+'Mode" class="chkModeAble" value="inherit" '+o+" /> "+XE.Lang.trans("xe::inheritMode")+"</label>",p+="</div>",p+="</div>"}p+='<div class="form-group">',p+="<label>회원 등급</label>",p+='<div class="radio">',i.forEach(function(a){var s=a.value==t?"checked":"";p+='<label><input type="radio" '+(n?'disabled="disabled"':"")+' name="'+e.type+'Rating" value="'+a.value+'" '+(s?'checked="checked"':"")+" /> "+a.name+" &nbsp;</label>"}),p+="</div>",p+="</div>",p+='<div class="form-group">',p+="<label>"+XE.Lang.trans("xe::includeUserOrGroup")+"</label>",p+='<div class="ReactTags__tags">',p+='<div class="ReactTags__selected groupWrap" data-ptype="group">',this.permission.group.forEach(function(e){var a=e,t="%"+(a.display_name||a.name);p+='<span class="ReactTags__tag">'+t+'<a href="#" class="ReactTags__remove btnRemoveTag" data-id="'+a.id+'">x</a></span>'}),p+="</div>",p+='<div class="ReactTags__selected userWrap" data-ptype="user">',this.permission.user.forEach(function(e){var a="@"+(e.display_name||e.name);p+='<span class="ReactTags__tag">'+a+'<a href="#" class="ReactTags__remove btnRemoveTag" data-id="'+e.id+'|">x</a></span>'}),p+="</div>",p+='<div class="ReactTags__tagInput">',p+='<input type="text" placeholder="'+this.placeholder+'" class="form-control inputMemberGroup" data-input="include" '+(n?'disabled="disabled"':"")+' value="'+this.query+'" data-index="-1" />',p+='<div class="ReactTags__suggestions" data-input="include"></div>',p+="</div>",p+='<input type="hidden" name="'+this.type+'Group" class="form-control includeGroups" value="'+r.join().trim()+'" />',p+='<input type="hidden" name="'+this.type+'User" class="form-control includeMembers" value="'+c.join().trim()+'" />',p+="</div>",p+="</div>",this.vgroupAll.length>=1&&(p+='<div class="form-group">',p+="<label>"+XE.Lang.trans("xe::includeVGroup")+"</label>",p+=e.vgroupAll.map(function(a){var t=!1;return-1!=function(e,a){for(var t=0;t<a.length;t++)if(a[t]==e)return t;return-1}(a.id,this.permission.vgroup)&&(t=!0),'<label><input type="checkbox" '+(n?'disabled="disabled"':"")+' name="'+e.type+'VGroup[]" value="'+a.id+'" '+(t?'checked="checked"':"")+" /> "+a.title+" &nbsp;</label>"}),p+="</div>"),p+='<div class="form-group">',p+="<label>"+XE.Lang.trans("xe::excludeUser")+"</label>",p+='<div class="ReactTags__tags">',p+='<div class="ReactTags__selected exceptWrap" data-ptype="except">',this.permission.except.forEach(function(e){var a=e.display_name||e.name;a="@"+a,p+='<span class="ReactTags__tag">'+a+'<a href="#" class="ReactTags__remove btnRemoveTag" data-id="'+e.id+'">x</a></span>'}),p+="</div>",p+='<div class="ReactTags__tagInput">',p+='<input type="text" placeholder="'+XE.Lang.trans("xe::explainExcludeUser")+'" class="form-control inputMemberGroup" data-input="exclude" '+(n?'disabled="disabled"':"")+' data-index="-1" />',p+='<div class="ReactTags__suggestions" data-input="exclude"></div>',p+="</div>",p+='<input type="hidden" name="'+this.type+'Except" class="form-control excludeMembers" value="'+l+'" />',p+="</div>",p+="</div>",p+="</div>",this.$wrapper.html(p)}}]),e}();$(".__xe__uiobject_permission").each(function(e){var a=$(this),t=a.data("data"),s=a.data("key"),i=a.data("type"),n=a.data("memberUrl"),c=a.data("groupUrl"),l=a.data("vgroupAll"),p=new r({$wrapper:a,key:s,memberSearchUrl:n,groupSearchUrl:c,permission:t,type:i,vgroupAll:l});p.render(),p.bindEvents()})}},[33]);